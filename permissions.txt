アクセス権限設定
==========

Localwikiでは柔軟なアクセス管理方式を採用しており、それぞれのオブジェクト(ページ、マップ、ファイル、その他)に対して、ユーザが追加、変更、削除の権限をどこまで有するかを管理者によって設定することができます。また、悪意のあるユーザに対する禁止ユーザ登録も実施可能です。


アクセス権限設定には2つのレベルがあります。: 1つはオブジェクトの種類(例:ページ、マップ、その他)に対する設定、もう一つは特定のオブジェクト(例: "Front Page"というページ)に対する設定です。この方式によって、まずは全てのオブジェクトに対する規定の制限を設定し、その上で幾つかのオブジェクトに対してはさらに細かい制限を設けたり、逆に設定をゆるめたりすることが可能です。


ユーザとグループ
--------------

ユーザは1つ以上のグループに所属することができます。また、グループはいつでも新規に作成することが可能です。管理者は特定のアクセス権限をグループ毎に付与し、グループに所属しているユーザはグループに対するアクセス権限設定を引き継ぎます。役割ベースのアクセス権限設定によって、例えば "Trusted Users(信頼済みのユーザ)"のようなグループを作成し、そのグループに対して追加のアクセス権限設定を付与することができます。


.. 注意点::

   アクセス権限設定は、個別のユーザではなくグループに対して行うことを推奨します。そのほうが管理性が高く(多数のユーザと少数のグループ)、なおかつ、メンテナンス性も向上します(ユーザは入れ替わることがあり、必要に応じてグループへ編集するほうが便利です)。

インストール手順に沿ってインストールを行った場合、以下のグループが規定で設定されているはずです。:

.. figure:: /_static/images/admin_groups.png

``Anonymous``
    このグループは ``AnonymousUser``(匿名ユーザ)を意味します。ログインをおこなっていない訪問者に対する権限設定となります。

``Authenticated``
    このグループは``AnonymousUser``(認証済みユーザ)、すなわちログインを行ったユーザを意味します。新しく作成されたユーザは自動的にこのグループに追加されます。ログインを行ったユーザ全てに対するデフォルトの設定として、このグループの設定を利用するのが便利です。
    
``Banned``
    全てのアクセス権限設定を剥奪されたグループです。ユーザが他に所属しているグループの権限に関係なく、すべてのアクセス権限が剥奪されます。

禁止ユーザ設定
--------------

ユーザの禁止設定を行うには、単純にそのユーザを``Banned``グループに追加してください。その他のグループからそのユーザを除外する必要はありません。``Banned``グループに追加されたユーザはすべてのアクセス権限設定を剥奪されます。

まずは、管理画面内の検索ボックスを使って対象のユーザを特定します。

.. figure:: /_static/images/admin_user_search.png

ユーザ名をクリックし、"Groups"の位置まで画面をスクロールさせます。 "Control" (Macでは "Command")キーを押しながら ``Banned``グループを選択し、"Save"を行います。

.. figure:: /_static/images/admin_ban_user.png

.. 注意点::

   While it's possible in the admin interface to delete a user, this is
   **NOT** recommended as it will also delete every change the user has made.
   If you need to disable a user's account, it's best to just unmark the
   "active" checkbox for that user.


Setting permissions for specific objects
----------------------------------------

If you view a Page in the admin interface and then click "Object permissions"
you can then enter a group name and select which permissions the given group
should have for that specific Page.  Only those groups you choose will be able
to add, edit, and delete the Page.

Say, for example, you want to lock down a page so that only logged-in users
can edit it.  First, find the page in the admin interface and click on
"Object permissions" in the top right.

.. figure:: /_static/images/admin_page_permissions1.png

Then in the Groups section enter "Authenticated" and click "Manage group".

.. figure:: /_static/images/admin_page_permissions2.png

Click the "Choose all" button and press "Save".

.. figure:: /_static/images/admin_page_permissions3.png

Now, only those users who have logged in will be able to edit this page.

To clear out per-object permissions and go back to the defaults, on the
"Object permissions" screen click "edit" next to each group and clear out all
permissions.  When there are no groups or users shown on the "Object
permissions" screen, the application will look at the default permissions for
that object type.


Setting default permissions
---------------------------

When per-object permissions are not set for an object, the permissions backend
looks at what permissions the user has (either directly or through the groups
to which the user belongs) for that type of object.

If needed, you can set these permissions through the admin interface.  Edit
each group and select which default permissions the group should have.

Editing all of your group permissions by hand can be a lot to manage, so we
provide a setting you can modify in ``settings.py`` and a command to apply
them.  At the time of writing this, the setting looks like this::

    USERS_DEFAULT_PERMISSIONS = {'auth.group':
                                 [{'name': USERS_DEFAULT_GROUP,
                                   'permissions':
                                     [['add_mapdata', 'maps', 'mapdata'],
                                      ['change_mapdata', 'maps', 'mapdata'],
                                      ['delete_mapdata', 'maps', 'mapdata'],
                                      ['add_page', 'pages', 'page'],
                                      ['change_page', 'pages', 'page'],
                                      ['delete_page', 'pages', 'page'],
                                      ['add_pagefile', 'pages', 'pagefile'],
                                      ['change_pagefile', 'pages', 'pagefile'],
                                      ['delete_pagefile', 'pages', 'pagefile'],
                                      ['add_redirect', 'redirects', 'redirect'],
                                      ['change_redirect', 'redirects', 'redirect'],
                                      ['delete_redirect', 'redirects', 'redirect'],
                                     ]
                                  },
                                  {'name': USERS_ANONYMOUS_GROUP,
                                   'permissions':
                                     [['add_mapdata', 'maps', 'mapdata'],
                                      ['change_mapdata', 'maps', 'mapdata'],
                                      ['delete_mapdata', 'maps', 'mapdata'],
                                      ['add_page', 'pages', 'page'],
                                      ['change_page', 'pages', 'page'],
                                      ['delete_page', 'pages', 'page'],
                                      ['add_pagefile', 'pages', 'pagefile'],
                                      ['change_pagefile', 'pages', 'pagefile'],
                                      ['delete_pagefile', 'pages', 'pagefile'],
                                      ['add_redirect', 'redirects', 'redirect'],
                                      ['change_redirect', 'redirects', 'redirect'],
                                      ['delete_redirect', 'redirects', 'redirect'],
                                     ]
                                  },
                                 ]
                                }

You can edit this setting by adding or removing permissions for certain groups
or adding your own groups.  To apply these permissions (and overwrite the
previously set defaults), run the following command::

    localwiki-manage reset_permissions

.. note ::
   Regardless of everything said in this section, administrators and superusers
   are always granted all permissions, no matter what groups they are in or
   even whether they are in the ``Banned`` group.
